(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[810],{3455:(e,a,t)=>{"use strict";t.d(a,{A:()=>d});var l=t(7876),s=t(4232),r=t(8230),n=t.n(r),i=t(9099);let o=[{label:"Dashboard Overview",href:"/dashboard/crm"},{label:"Clients",href:"/dashboard/crm/clients"},{label:"Invoices",href:"/dashboard/crm/invoices"},{label:"Products/Services",href:"/dashboard/crm/products"},{label:"Business Profile",href:"/dashboard/crm/profile"},{label:"Payments (Manual)",href:"/dashboard/crm/payments"}];function d(e){let{children:a}=e,t=(0,i.useRouter)(),[r,d]=(0,s.useState)(!1);return(0,l.jsxs)("div",{className:"min-h-screen flex font-sans",children:[(0,l.jsxs)("aside",{className:"hidden md:flex w-64 bg-gradient-to-b from-[#1a1333] via-[#2d1a4d] to-[#6a5cff] text-white/90 p-6 flex-col gap-6 border-r border-white/10 backdrop-blur-xl",children:[(0,l.jsx)("div",{className:"text-2xl font-extrabold bg-gradient-to-r from-[#ff5f8f] to-[#6a5cff] bg-clip-text text-transparent mb-8",children:"Leadflowgenius CRM"}),(0,l.jsx)("nav",{className:"flex flex-col gap-3",children:o.map(e=>(0,l.jsx)(n(),{href:e.href,legacyBehavior:!0,children:(0,l.jsx)("a",{className:"block px-4 py-2 rounded transition-colors ".concat(t.pathname===e.href?"bg-blue-700 font-semibold":"hover:bg-blue-800"),children:e.label})},e.href))})]}),(0,l.jsx)("button",{className:"md:hidden fixed top-4 left-4 z-50 bg-[#1a1333] text-white p-2 rounded shadow-lg focus:outline-none focus:ring-2 focus:ring-white/50","aria-label":"Open navigation menu",onClick:()=>d(!0),children:(0,l.jsx)("svg",{className:"h-7 w-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),r&&(0,l.jsxs)("div",{className:"md:hidden fixed inset-0 z-40 flex",children:[(0,l.jsxs)("div",{className:"w-64 bg-gradient-to-b from-[#1a1333] via-[#2d1a4d] to-[#6a5cff] text-white/90 p-6 flex flex-col gap-6 border-r border-white/10 backdrop-blur-xl animate-slide-in-left relative",children:[(0,l.jsx)("button",{className:"absolute top-4 right-4 text-white p-2 rounded focus:outline-none focus:ring-2 focus:ring-white/50","aria-label":"Close navigation menu",onClick:()=>d(!1),children:(0,l.jsx)("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,l.jsx)("div",{className:"text-2xl font-extrabold bg-gradient-to-r from-[#ff5f8f] to-[#6a5cff] bg-clip-text text-transparent mb-8",children:"Leadflowgenius CRM"}),(0,l.jsx)("nav",{className:"flex flex-col gap-3",children:o.map(e=>(0,l.jsx)(n(),{href:e.href,legacyBehavior:!0,children:(0,l.jsx)("a",{className:"block px-4 py-2 rounded transition-colors ".concat(t.pathname===e.href?"bg-blue-700 font-semibold":"hover:bg-blue-800"),onClick:()=>d(!1),children:e.label})},e.href))})]}),(0,l.jsx)("div",{className:"flex-1 bg-black bg-opacity-40",onClick:()=>d(!1)})]}),(0,l.jsx)("main",{className:"flex-1 bg-gradient-to-br from-[#1a1333]/80 via-[#2d1a4d]/80 to-[#ff5f8f]/60 p-6 md:p-12 min-h-screen overflow-y-auto",children:(0,l.jsx)("div",{className:"max-w-6xl mx-auto bg-white/10 backdrop-blur-2xl rounded-2xl shadow-2xl border border-white/10 p-6 md:p-12",children:a})})]})}},4012:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/crm/invoice/new",function(){return t(6523)}])},6523:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>c});var l=t(7876),s=t(4232),r=t(9099),n=t(9966),i=t(3455);let o=[{label:"USD",value:"USD"},{label:"ZWL",value:"ZWL"},{label:"ZAR",value:"ZAR"}],d={name:"",description:"",quantity:1,price:0,tax:0};function c(){let e=(0,r.useRouter)(),{clientId:a}=e.query,[t,c]=(0,s.useState)(""),[u,x]=(0,s.useState)(""),[m,h]=(0,s.useState)("USD"),[b,p]=(0,s.useState)([{...d}]),[f,v]=(0,s.useState)(""),[g,j]=(0,s.useState)(!1),[N,w]=(0,s.useState)(""),[y,k]=(0,s.useState)([]);(0,s.useEffect)(()=>{(async()=>{var e;let a=null==(e=(await n.N.auth.getSession()).data.session)?void 0:e.access_token;if(!a)return;let t=await fetch("/api/products",{headers:{Authorization:"Bearer ".concat(a)}});t.ok&&k((await t.json()).products)})()},[]);let C=b.reduce((e,a)=>{let t=a.quantity*a.price,l=t*(a.tax?a.tax/100:0);return e+t+l},0),S=(e,a,t)=>{p(l=>l.map((l,s)=>s===e?{...l,[a]:t}:l))},_=async l=>{l.preventDefault(),j(!0),w("");try{var s;let l=null==(s=(await n.N.auth.getSession()).data.session)?void 0:s.access_token;if(!l){w("Not authenticated"),j(!1);return}let r=await fetch("/api/invoices",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({clientId:a,title:t,dueDate:u,currency:m,items:b,notes:f,totalAmount:C})});if(r.ok){let a=await r.json();e.push("/dashboard/crm/invoice/".concat(a.id,"/preview"))}else{let e=await r.json();w(e.error||"Failed to create invoice")}}catch(e){w("Failed to create invoice")}j(!1)};return(0,l.jsx)(i.A,{children:(0,l.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-[#1a1333] via-[#2d1a4d] to-[#ff5f8f] p-4 md:p-8 flex flex-col items-center",children:(0,l.jsxs)("div",{className:"w-full max-w-2xl bg-white/10 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/10 p-8",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-6 text-white",children:"Create Invoice"}),(0,l.jsxs)("form",{onSubmit:_,className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Invoice Title"}),(0,l.jsx)("input",{type:"text",className:"w-full px-3 py-2 border rounded",value:t,onChange:e=>c(e.target.value),required:!0})]}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Due Date"}),(0,l.jsx)("input",{type:"date",className:"w-full px-3 py-2 border rounded",value:u,onChange:e=>x(e.target.value),required:!0})]}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Currency"}),(0,l.jsx)("select",{className:"w-full px-3 py-2 border rounded",value:m,onChange:e=>h(e.target.value),children:o.map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Line Items"}),(0,l.jsxs)("div",{className:"space-y-2",children:[b.map((e,a)=>{var t;let[r,n]=(0,s.useState)(!!e.tax);return(0,l.jsxs)("div",{className:"flex gap-2 items-end bg-gray-50 p-2 rounded mb-2 border border-gray-200",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Product/Service"}),(0,l.jsxs)("select",{className:"w-full px-2 py-1 border rounded mb-1",value:y.find(a=>a.name===e.name)?null==(t=y.find(a=>a.name===e.name))?void 0:t.id:"custom",onChange:e=>((e,a)=>{if("custom"===a){S(e,"name",""),S(e,"description",""),S(e,"price",0);return}let t=y.find(e=>e.id===a);t&&(S(e,"name",t.name),S(e,"description",t.description||""),S(e,"price",t.price))})(a,e.target.value),children:[(0,l.jsx)("option",{value:"custom",children:"Custom"}),y.map(e=>(0,l.jsxs)("option",{value:e.id,children:[e.name," - $",e.price.toFixed(2)]},e.id))]}),(0,l.jsx)("input",{type:"text",placeholder:"Service or Product",className:"w-full px-2 py-1 border rounded",value:e.name,onChange:e=>S(a,"name",e.target.value),required:!0}),(0,l.jsx)("textarea",{placeholder:"Description (optional)",className:"w-full px-2 py-1 border rounded mt-1",value:e.description||"",onChange:e=>S(a,"description",e.target.value)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Qty"}),(0,l.jsx)("input",{type:"number",min:1,placeholder:"Qty",className:"w-16 px-2 py-1 border rounded",value:e.quantity,onChange:e=>S(a,"quantity",Number(e.target.value)),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Unit Price"}),(0,l.jsx)("input",{type:"number",min:0,step:.01,placeholder:"Unit Price",className:"w-24 px-2 py-1 border rounded",value:e.price,onChange:e=>S(a,"price",Number(e.target.value)),required:!0})]}),r?(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-xs text-gray-500 mb-1",children:["Tax % ",(0,l.jsx)("span",{className:"text-gray-400",children:"(optional)"})]}),(0,l.jsx)("input",{type:"number",min:0,max:100,step:.01,placeholder:"Tax %",className:"w-20 px-2 py-1 border rounded",value:e.tax,onChange:e=>S(a,"tax",Number(e.target.value))})]}):(0,l.jsx)("button",{type:"button",className:"text-xs text-blue-500 mt-5",onClick:()=>n(!0),children:"+ Add Tax"}),(0,l.jsxs)("div",{className:"text-xs text-gray-700 ml-2 mb-1",children:["Subtotal: $",(e.quantity*e.price*(1+(e.tax||0)/100)).toFixed(2)]}),(0,l.jsx)("button",{type:"button",className:"text-red-500 px-2 mb-1",onClick:()=>p(e=>e.filter((e,t)=>t!==a)),disabled:1===b.length,children:"\xd7"})]},a)}),(0,l.jsx)("button",{type:"button",className:"mt-2 text-blue-600 hover:underline",onClick:()=>p([...b,{...d}]),children:"+ Add Item"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Notes"}),(0,l.jsx)("textarea",{className:"w-full px-3 py-2 border rounded",value:f,onChange:e=>v(e.target.value),placeholder:"Thanks for your business!"})]}),N&&(0,l.jsx)("div",{className:"text-red-500 text-sm",children:N}),(0,l.jsxs)("div",{className:"flex justify-between items-center mt-6",children:[(0,l.jsxs)("span",{className:"text-lg font-semibold",children:["Total: ",(0,l.jsxs)("span",{className:"text-blue-700",children:[m," ",C.toFixed(2)]})]}),(0,l.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700",disabled:g,children:g?"Saving...":"Save Invoice"})]})]})]})})})}},9099:(e,a,t)=>{e.exports=t(8253)}},e=>{e.O(0,[230,636,593,792],()=>e(e.s=4012)),_N_E=e.O()}]);