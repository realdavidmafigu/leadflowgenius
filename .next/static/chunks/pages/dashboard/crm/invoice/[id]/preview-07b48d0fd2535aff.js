(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[576],{477:()=>{},2012:(e,t,l)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/crm/invoice/[id]/preview",function(){return l(5602)}])},3455:(e,t,l)=>{"use strict";l.d(t,{A:()=>c});var a=l(7876),s=l(4232),n=l(8230),i=l.n(n),r=l(9099);let o=[{label:"Dashboard Overview",href:"/dashboard/crm"},{label:"Clients",href:"/dashboard/crm/clients"},{label:"Invoices",href:"/dashboard/crm/invoices"},{label:"Products/Services",href:"/dashboard/crm/products"},{label:"Business Profile",href:"/dashboard/crm/profile"},{label:"Payments (Manual)",href:"/dashboard/crm/payments"}];function c(e){let{children:t}=e,l=(0,r.useRouter)(),[n,c]=(0,s.useState)(!1);return(0,a.jsxs)("div",{className:"min-h-screen flex font-sans",children:[(0,a.jsxs)("aside",{className:"hidden md:flex w-64 bg-gradient-to-b from-[#1a1333] via-[#2d1a4d] to-[#6a5cff] text-white/90 p-6 flex-col gap-6 border-r border-white/10 backdrop-blur-xl",children:[(0,a.jsx)("div",{className:"text-2xl font-extrabold bg-gradient-to-r from-[#ff5f8f] to-[#6a5cff] bg-clip-text text-transparent mb-8",children:"Leadflowgenius CRM"}),(0,a.jsx)("nav",{className:"flex flex-col gap-3",children:o.map(e=>(0,a.jsx)(i(),{href:e.href,legacyBehavior:!0,children:(0,a.jsx)("a",{className:"block px-4 py-2 rounded transition-colors ".concat(l.pathname===e.href?"bg-blue-700 font-semibold":"hover:bg-blue-800"),children:e.label})},e.href))})]}),(0,a.jsx)("button",{className:"md:hidden fixed top-4 left-4 z-50 bg-[#1a1333] text-white p-2 rounded shadow-lg focus:outline-none focus:ring-2 focus:ring-white/50","aria-label":"Open navigation menu",onClick:()=>c(!0),children:(0,a.jsx)("svg",{className:"h-7 w-7",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),n&&(0,a.jsxs)("div",{className:"md:hidden fixed inset-0 z-40 flex",children:[(0,a.jsxs)("div",{className:"w-64 bg-gradient-to-b from-[#1a1333] via-[#2d1a4d] to-[#6a5cff] text-white/90 p-6 flex flex-col gap-6 border-r border-white/10 backdrop-blur-xl animate-slide-in-left relative",children:[(0,a.jsx)("button",{className:"absolute top-4 right-4 text-white p-2 rounded focus:outline-none focus:ring-2 focus:ring-white/50","aria-label":"Close navigation menu",onClick:()=>c(!1),children:(0,a.jsx)("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,a.jsx)("div",{className:"text-2xl font-extrabold bg-gradient-to-r from-[#ff5f8f] to-[#6a5cff] bg-clip-text text-transparent mb-8",children:"Leadflowgenius CRM"}),(0,a.jsx)("nav",{className:"flex flex-col gap-3",children:o.map(e=>(0,a.jsx)(i(),{href:e.href,legacyBehavior:!0,children:(0,a.jsx)("a",{className:"block px-4 py-2 rounded transition-colors ".concat(l.pathname===e.href?"bg-blue-700 font-semibold":"hover:bg-blue-800"),onClick:()=>c(!1),children:e.label})},e.href))})]}),(0,a.jsx)("div",{className:"flex-1 bg-black bg-opacity-40",onClick:()=>c(!1)})]}),(0,a.jsx)("main",{className:"flex-1 bg-gradient-to-br from-[#1a1333]/80 via-[#2d1a4d]/80 to-[#ff5f8f]/60 p-6 md:p-12 min-h-screen overflow-y-auto",children:(0,a.jsx)("div",{className:"max-w-6xl mx-auto bg-white/10 backdrop-blur-2xl rounded-2xl shadow-2xl border border-white/10 p-6 md:p-12",children:t})})]})}},5602:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>h});var a=l(7876),s=l(4232),n=l(9099),i=l(9966),r=l(3455),o=l(5273);let c=o.vv.create({page:{padding:32,fontSize:12,fontFamily:"Helvetica"},header:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:24},logo:{height:48,width:48,objectFit:"contain"},businessInfo:{flex:1,marginLeft:16},section:{marginBottom:16},table:{width:"100%",borderWidth:1,borderColor:"#eee",marginBottom:16},tableRow:{flexDirection:"row",borderBottomWidth:1,borderColor:"#eee"},tableCell:{flex:1,padding:6},tableHeader:{fontWeight:"bold",backgroundColor:"#f3f4f6"},total:{textAlign:"right",fontWeight:"bold",fontSize:14,marginTop:8},thankYou:{marginTop:32,fontSize:13,textAlign:"center",color:"#2563eb"},footer:{marginTop:32,fontSize:10,textAlign:"center",color:"#888"}});function d(e){let{invoice:t,client:l,businessProfile:s}=e;return(0,a.jsx)(o.yo,{children:(0,a.jsxs)(o.YW,{size:"A4",style:c.page,children:[(0,a.jsxs)(o.Ss,{style:c.header,children:[(null==s?void 0:s.logoUrl)&&(0,a.jsx)(o._V,{src:s.logoUrl,style:c.logo}),(0,a.jsxs)(o.Ss,{style:c.businessInfo,children:[(0,a.jsx)(o.EY,{style:{fontSize:18,fontWeight:"bold"},children:(null==s?void 0:s.name)||"Business Name"}),(0,a.jsx)(o.EY,{children:null==s?void 0:s.address}),(0,a.jsx)(o.EY,{children:null==s?void 0:s.phone}),(0,a.jsx)(o.EY,{children:null==s?void 0:s.email}),(null==s?void 0:s.website)&&(0,a.jsx)(o.EY,{children:s.website})]})]}),(0,a.jsxs)(o.Ss,{style:c.section,children:[(0,a.jsx)(o.EY,{style:{fontWeight:"bold",marginBottom:2},children:"Receipt To:"}),(0,a.jsx)(o.EY,{children:l.name}),(0,a.jsx)(o.EY,{children:l.email}),(0,a.jsx)(o.EY,{children:l.phone}),l.company&&(0,a.jsx)(o.EY,{children:l.company})]}),(0,a.jsxs)(o.Ss,{style:c.section,children:[(0,a.jsxs)(o.EY,{children:["Invoice #: ",t.id]}),(0,a.jsxs)(o.EY,{children:["Date Paid: ",t.updatedAt?new Date(t.updatedAt).toLocaleDateString():new Date().toLocaleDateString()]})]}),(0,a.jsxs)(o.Ss,{style:c.table,children:[(0,a.jsxs)(o.Ss,{style:[c.tableRow,c.tableHeader],children:[(0,a.jsx)(o.EY,{style:c.tableCell,children:"Item"}),(0,a.jsx)(o.EY,{style:c.tableCell,children:"Qty"}),(0,a.jsx)(o.EY,{style:c.tableCell,children:"Unit Price"}),(0,a.jsx)(o.EY,{style:c.tableCell,children:"Tax %"}),(0,a.jsx)(o.EY,{style:c.tableCell,children:"Total"})]}),t.items.map((e,t)=>(0,a.jsxs)(o.Ss,{style:c.tableRow,children:[(0,a.jsx)(o.EY,{style:c.tableCell,children:e.name}),(0,a.jsx)(o.EY,{style:c.tableCell,children:e.quantity}),(0,a.jsxs)(o.EY,{style:c.tableCell,children:["$",e.price.toFixed(2)]}),(0,a.jsx)(o.EY,{style:c.tableCell,children:e.tax||0}),(0,a.jsxs)(o.EY,{style:c.tableCell,children:["$",(e.quantity*e.price*(1+(e.tax||0)/100)).toFixed(2)]})]},t))]}),(0,a.jsxs)(o.EY,{style:c.total,children:["Total Paid: $",t.totalAmount.toFixed(2)]}),(0,a.jsx)(o.EY,{style:{marginTop:8},children:"Payment Method: Manual"}),t.paymentReference&&(0,a.jsxs)(o.EY,{children:["Reference: ",t.paymentReference]}),(0,a.jsx)(o.EY,{style:c.thankYou,children:"Thank you for your business!"}),(0,a.jsx)(o.EY,{style:c.footer,children:"This receipt was generated by Leadflowgenius CRM"})]})})}function h(){let{id:e}=(0,n.useRouter)().query,[t,l]=(0,s.useState)(null),[c,h]=(0,s.useState)(null),[x,m]=(0,s.useState)(!0),[f,b]=(0,s.useState)(""),[u,j]=(0,s.useState)(!1),[g,p]=(0,s.useState)(null),[y,v]=(0,s.useState)(null);if((0,s.useEffect)(()=>{e&&(async()=>{m(!0),b("");try{var t;let a=null==(t=(await i.N.auth.getSession()).data.session)?void 0:t.access_token;if(!a){b("Not authenticated"),m(!1);return}let s=await fetch("/api/invoices?id=".concat(e),{headers:{Authorization:"Bearer ".concat(a)}});if(s.ok){let e=await s.json();l(e.invoice),h(e.client)}else b("Invoice not found");let n=await fetch("/api/business-profile",{headers:{Authorization:"Bearer ".concat(a)}});if(n.ok){let e=await n.json();v(e.profile)}}catch(e){b("Failed to fetch invoice")}m(!1)})()},[e]),x)return(0,a.jsx)("div",{className:"p-8 text-center text-gray-400",children:"Loading..."});if(f)return(0,a.jsx)("div",{className:"p-8 text-center text-red-500",children:f});if(!t||!c)return null;let w="Hey ".concat(c.name,", here's your invoice for ").concat(t.title,". Click here to view & pay: [link]"),N="https://wa.me/?text=".concat(encodeURIComponent(w)),k=async()=>{j(!0),b("");try{var t;let l=null==(t=(await i.N.auth.getSession()).data.session)?void 0:t.access_token;if(!l){b("Not authenticated"),j(!1);return}let a=await fetch("/api/invoices",{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(l)},body:JSON.stringify({id:e,action:"generatePaymentLink"})});if(a.ok){let e=await a.json();p("".concat(window.location.origin,"/pay/").concat(e.paymentLink))}else{let e=await a.json();b(e.error||"Failed to generate link")}}catch(e){b("Failed to generate link")}j(!1)};return(0,a.jsx)(r.A,{children:(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-4 md:p-8 flex flex-col items-center",children:(0,a.jsxs)("div",{className:"w-full max-w-2xl bg-white rounded-lg shadow p-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Invoice Preview"}),(0,a.jsx)("span",{className:"px-3 py-1 rounded bg-gray-100 text-gray-700 text-sm",children:t.status})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"font-semibold",children:"To:"}),(0,a.jsx)("div",{children:c.name}),(0,a.jsx)("div",{children:c.email}),(0,a.jsx)("div",{children:c.company})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Invoice Title:"}),(0,a.jsx)("div",{children:t.title}),(0,a.jsx)("div",{className:"font-semibold mt-2",children:"Due Date:"}),(0,a.jsx)("div",{children:new Date(t.dueDate).toLocaleDateString()})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"font-semibold mb-2",children:"Line Items"}),(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left",children:"Item"}),(0,a.jsx)("th",{className:"text-right",children:"Qty"}),(0,a.jsx)("th",{className:"text-right",children:"Price"}),(0,a.jsx)("th",{className:"text-right",children:"Tax %"}),(0,a.jsx)("th",{className:"text-right",children:"Total"})]})}),(0,a.jsx)("tbody",{children:t.items.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.name}),(0,a.jsx)("td",{className:"text-right",children:e.quantity}),(0,a.jsx)("td",{className:"text-right",children:e.price.toFixed(2)}),(0,a.jsx)("td",{className:"text-right",children:e.tax||0}),(0,a.jsx)("td",{className:"text-right",children:(e.quantity*e.price*(1+(e.tax||0)/100)).toFixed(2)})]},t))})]})]}),(0,a.jsx)("div",{className:"mb-6 flex justify-end",children:(0,a.jsxs)("div",{className:"text-lg font-semibold",children:["Total: ",(0,a.jsxs)("span",{className:"text-blue-700",children:[t.currency," ",t.totalAmount.toFixed(2)]})]})}),t.notes&&(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Notes:"}),(0,a.jsx)("div",{children:t.notes})]}),(0,a.jsxs)("div",{className:"flex gap-4 mt-8 flex-wrap",children:[(0,a.jsx)("a",{href:N,target:"_blank",rel:"noopener noreferrer",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Send Invoice (WhatsApp)"}),(0,a.jsx)("button",{className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",disabled:!0,children:"Download PDF (coming soon)"}),!t.paymentLink&&!g&&(0,a.jsx)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:k,disabled:u,children:u?"Generating...":"Generate Link"}),(t.paymentLink||g)&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Public Link:"}),(0,a.jsx)("a",{href:"/pay/".concat(t.paymentLink||g),className:"text-blue-600 underline break-all",target:"_blank",rel:"noopener noreferrer",children:"".concat(window.location.origin,"/pay/").concat(t.paymentLink||g)})]}),"Paid"===t.status&&y&&(0,a.jsx)(o.XP,{document:(0,a.jsx)(d,{invoice:t,client:c,businessProfile:y}),fileName:"Receipt-".concat(t.id,".pdf"),className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",children:e=>{let{loading:t}=e;return t?"Generating PDF...":"Download Receipt"}})]})]})})})}}},e=>{e.O(0,[591,341,5,155,230,800,636,593,792],()=>e(e.s=2012)),_N_E=e.O()}]);