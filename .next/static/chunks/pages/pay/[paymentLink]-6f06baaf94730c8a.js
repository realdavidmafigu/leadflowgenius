(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[427],{4548:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/pay/[paymentLink]",function(){return s(8102)}])},8102:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(7876),l=s(4232),i=s(9099);function n(){let{paymentLink:e}=(0,i.useRouter)().query,[t,s]=(0,l.useState)(null),[n,c]=(0,l.useState)(null),[r,d]=(0,l.useState)(!0),[m,o]=(0,l.useState)(""),[x,h]=(0,l.useState)(!1),[u,p]=(0,l.useState)({clientName:"",message:"",proof:null}),[b,j]=(0,l.useState)(!1),[N,f]=(0,l.useState)(!1);(0,l.useEffect)(()=>{e&&(async()=>{d(!0),o("");try{let t=await fetch("/api/public-invoice?paymentLink=".concat(e));if(t.ok){let e=await t.json();s(e.invoice),c(e.client)}else o("Invoice not found")}catch(e){o("Failed to fetch invoice")}d(!1)})()},[e]);let g=e=>{let{name:t,value:s,files:a}=e.target;p(e=>({...e,[t]:a?a[0]:s}))},y=async e=>{e.preventDefault(),j(!0),f(!1),o("");try{let e="";if(u.proof){let t=new FormData;t.append("file",u.proof);let s=await fetch("/api/upload-proof",{method:"POST",body:t});if(s.ok){let{url:t}=await s.json();e=t}}let s=await fetch("/api/manual-payments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({invoiceId:t.id,clientName:u.clientName,message:u.message,proofUrl:e})});if(s.ok)f(!0),h(!1);else{let e=await s.json();o(e.error||"Failed to submit payment")}}catch(e){o("Failed to submit payment")}j(!1)};return r?(0,a.jsx)("div",{className:"p-8 text-center text-gray-400",children:"Loading..."}):m?(0,a.jsx)("div",{className:"p-8 text-center text-red-500",children:m}):t&&n?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 p-4 flex flex-col items-center",children:(0,a.jsxs)("div",{className:"w-full max-w-lg bg-white rounded-lg shadow p-6 mt-6",children:[(0,a.jsxs)("div",{className:"mb-4 text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-1",children:n.company||"Invoice"}),(0,a.jsxs)("div",{className:"text-gray-500",children:["Invoice for ",n.name]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"font-semibold",children:"Due Date:"}),(0,a.jsx)("div",{children:new Date(t.dueDate).toLocaleDateString()})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"font-semibold mb-2",children:"Line Items"}),(0,a.jsxs)("table",{className:"min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left",children:"Item"}),(0,a.jsx)("th",{className:"text-right",children:"Qty"}),(0,a.jsx)("th",{className:"text-right",children:"Price"}),(0,a.jsx)("th",{className:"text-right",children:"Tax %"}),(0,a.jsx)("th",{className:"text-right",children:"Total"})]})}),(0,a.jsx)("tbody",{children:t.items.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.name}),(0,a.jsx)("td",{className:"text-right",children:e.quantity}),(0,a.jsx)("td",{className:"text-right",children:e.price.toFixed(2)}),(0,a.jsx)("td",{className:"text-right",children:e.tax||0}),(0,a.jsx)("td",{className:"text-right",children:(e.quantity*e.price*(1+(e.tax||0)/100)).toFixed(2)})]},t))})]})]}),(0,a.jsx)("div",{className:"mb-4 flex justify-end",children:(0,a.jsxs)("div",{className:"text-lg font-semibold",children:["Total: ",(0,a.jsxs)("span",{className:"text-blue-700",children:[t.currency," ",t.totalAmount.toFixed(2)]})]})}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("div",{className:"font-semibold mb-1",children:"Payment Instructions"}),(0,a.jsx)("ul",{className:"list-disc pl-5 text-gray-700",children:["Send Ecocash to 0772 123 456 (Name: David Mafigu)","Bank Transfer to Steward Bank, Acc No: 12345678"].map((e,t)=>(0,a.jsx)("li",{children:e},t))})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("span",{className:"inline-block px-3 py-1 rounded bg-gray-100 text-gray-700 text-sm",children:["Status: ",t.paid?"Paid":"Unpaid"]})}),N&&(0,a.jsx)("div",{className:"text-green-600 mb-4",children:"Payment confirmation submitted! Thank you."}),!t.paid&&!x&&(0,a.jsx)("button",{className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700",onClick:()=>h(!0),children:"Mark as Paid"}),x&&(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4 mt-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Your Name"}),(0,a.jsx)("input",{type:"text",name:"clientName",className:"w-full px-3 py-2 border rounded",value:u.clientName,onChange:g,required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Message or Reference"}),(0,a.jsx)("textarea",{name:"message",className:"w-full px-3 py-2 border rounded",value:u.message,onChange:g,placeholder:"Transaction reference, notes, etc."})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Upload Payment Proof (screenshot, optional)"}),(0,a.jsx)("input",{type:"file",name:"proof",accept:"image/*",className:"w-full",onChange:g})]}),m&&(0,a.jsx)("div",{className:"text-red-500 text-sm",children:m}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"submit",className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",disabled:b,children:b?"Submitting...":"Submit Payment Confirmation"}),(0,a.jsx)("button",{type:"button",className:"bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300",onClick:()=>h(!1),children:"Cancel"})]})]})]})}):null}},9099:(e,t,s)=>{e.exports=s(8253)}},e=>{e.O(0,[636,593,792],()=>e(e.s=4548)),_N_E=e.O()}]);